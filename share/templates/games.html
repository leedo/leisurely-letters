? my ($app, $user, $games, $baduser, $invited) = @_;
? use DateTime;
? my @completed;

<script type="text/javascript">
  document.observe("dom:loaded", function () {
    var input = $('user_search');
    input.observe("focus", function (event) {
      if (input.value == "email address") {
        input.value = "";
        input.removeClassName("empty");
      }
    });
    input.observe("blur", function (event) {
      if (input.value == "") {
        input.value = "email address";
        input.addClassName("empty");
      }
    });
  });
</script>
<form action="/new" method="post">
  <p id="create_game">Create a new game with
  <input type="email" name="opponent" id="user_search" class="empty" value="email address" autocomplete="off" />
  </p>
</form>

? if ($baduser) {
  <p class="error"><?= $baduser ?> is not registered,
    <a href="/invite?email=<?= $baduser ?>">click here to send an invite</a>
  </p>
? }

? if ($invited) {
  <p class="error"><?= $invited ?> has been invited.</p>
? }

<div class="games">
<h2>Active Games</h2>
<ul>
? while (my $game = $games->next) {
? if ($game->completed) {
?   push @completed, $game;
?   next;
? }
<li<? if ($game->is_current_player($user)) { ?> class="active"<? } ?>>
? my $duration = DateTime->now - DateTime->from_epoch(epoch => $game->last_update);
? my ($days, $hours, $minutes) = ($duration->days, $duration->hours, $duration->minutes);
  <a href="/game/<?= $game->id ?>">
    <?= $game->opponent($user)->display_name ?><br>
    <span class="email"><?= $game->opponent($user)->email ?><br>
      <? if ($days) { ?>
      <?= $days ?> days
      <? } elsif ($hours) { ?>
      <?= $hours ?> hours
      <? } else { ?>
      <?= $minutes ?> minutes
      <? } ?>
      ago
    </span>
  </a>
</li>
? }
</ul>
</div>

<div class="games">
<h2>Completed Games</h2>
<ul>
? for my $game (@completed) {
? my $duration = DateTime->now - DateTime->from_epoch(epoch => $game->last_update);
? my ($days, $hours, $minutes) = ($duration->days, $duration->hours, $duration->minutes);
<li>
<a href="/game/<?= $game->id ?>">
    <?= $game->opponent($user)->display_name ?><br>
    <span class="email"><?= $game->opponent($user)->email ?><br>
      <? if ($days) { ?>
      <?= $days ?> days
      <? } elsif ($hours) { ?>
      <?= $hours ?> hours
      <? } else { ?>
      <?= $minutes ?> minutes
      <? } ?>
      ago

    </span>
  </a>
</li>
? }
</ul>
</div>
